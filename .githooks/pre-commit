#!/bin/bash

# Pre-commit hook to remove Working Directory lines from iTerm2 plist file

PLIST_FILE="itermconfigs/com.googlecode.iterm2.plist"

# Check if the file exists and is being committed
if [ -f "$PLIST_FILE" ]; then
    # Check if the Working Directory key exists in the file
    if grep -q "<key>Working Directory</key>" "$PLIST_FILE"; then
        # Use awk to remove the Working Directory key and the following string line
        # This works reliably on both macOS and Linux
        awk '
            /<key>Working Directory<\/key>/ {
                getline  # Skip the next line (the string value)
                next     # Skip the current line (the key)
            }
            { print }    # Print all other lines
        ' "$PLIST_FILE" > "$PLIST_FILE.tmp" && mv "$PLIST_FILE.tmp" "$PLIST_FILE"
        
        # Stage the modified file
        git add "$PLIST_FILE"
    fi
fi

exit 0

